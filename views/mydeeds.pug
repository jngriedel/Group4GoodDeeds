extends layout.pug

include includes/utils

block content

    script(src="/javascripts/editReview.js" type="module")
    div(id='main')
        a(href="/karmas") edit
        div(id='karma-list')
          h3 Karmas
          ul
            if karmas
            each karma in karmas
              li= karma.title

        table
            thead
                tr
                    th Deed
                    th Title
                    th Average Rating
                    th Rating
                    th Karmas
                    th Review
                    th Date Created
                    th Edit Review
                    th Delete Review
            tbody
                each review, index in reviews
                    tr
                        td(id=`reviewNameC${review.id}`)
                          a(href=`/deeds/${review.Deed.id}`)= review.Deed.name
                        td(id=`reviewTitleC${review.id}`)= review.title
                        td(id=`reviewAvgC${review.id}`)= review.Deed.rating
                        td(id=`reviewRatingC${review.id}`)
                          span= review.rating
                        td(id=`reviewKarmas${review.id}`)
                          a(id=`edit-karmas-${review.id}` href='#') [edit]
                          if karmas
                           div(id=`karma-radio-bttns-${review.id}` class='hidden-karma-buttons')
                            a(id=`close-${review.id}` class='close-karma-radio' href='#') close
                            br
                            each karma, index in karmas
                              input(type='checkbox' name=`${karma.title}` id=`${karma.id}-${review.Deed.id}` class=`checkbox-${review.id}`)
                              lable(for=`${karma.title}`)= karma.title
                              br
                        td(id=`reviewBodyC${review.id}`)= review.body
                        td(id=`reviewDateC${review.id}`)= dates[index]
                        td
                            button(id=`edit-button-${review.id}`) Edit

                        td
                            form(action=`/reviews/${review.id}` method='post')
                                button(type='submit') Delete


    each review, index in reviews
      div(id=`form-box-${review.id}` class=`review-hidden`)
                        div()
                            div()
                            +validationErrorSummary(errors)
                            form(action=`/reviews/${review.id}` method='patch')
                            input(type='hidden' name='_csrf' value=csrfToken)
                            input(type='hidden' id=`reviewHolder${index}` value=review.id)
                            input(type='hidden' id=`ratingHolder${review.id}` value=review.rating)
                            +field('Title', `title-${review.id}`, review.title)
                            +field('Review Body', `body-${review.id}`, review.body)
                            label(for="star-container") Rating
                            div(class ="rating" id="star-container")
                                input(id=`star5${review.id}` name="star" type="radio" value="5" class="radio-btn hide")
                                label(for=`star5${review.id}`) ☆
                                input(id=`star4${review.id}` name="star" type="radio" value="4" class="radio-btn hide")
                                label(for=`star4${review.id}`) ☆
                                input(id=`star3${review.id}` name="star" type="radio" value="3" class="radio-btn hide")
                                label(for=`star3${review.id}`) ☆
                                input(id=`star2${review.id}` name="star" type="radio" value="2" class="radio-btn hide")
                                label(for=`star2${review.id}`) ☆
                                input(id=`star1${review.id}` name="star" type="radio" value="1" class="radio-btn hide")
                                label(for=`star1${review.id}`) ☆
                            div
                                button(id= `save-edit-${review.id}`) Save Review
                                button(id=`cancel-edit-${review.id}`) Cancel
